CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `db_covid`.`total_cases_by_location_per_yr` AS select `t`.`_Yr` AS `_Yr`,`t`.`location` AS `location`,`t`.`total_cases_perLocation` AS `total_cases_perLocation`,lag(`t`.`total_cases_perLocation`,1) OVER (PARTITION BY `t`.`location` ORDER BY `t`.`_Yr` )  AS `PrevYr`,(`t`.`total_cases_perLocation` - lag(`t`.`total_cases_perLocation`,1) OVER (PARTITION BY `t`.`location` ORDER BY `t`.`_Yr` ) ) AS `variance`,sum(`t`.`total_cases_perLocation`) OVER (PARTITION BY `t`.`_Yr` )  AS `overAll_totalperYr`,round(((cast(`t`.`total_cases_perLocation` as float) / sum(`t`.`total_cases_perLocation`) OVER (PARTITION BY `t`.`_Yr` ) ) * 100),2) AS `percent_byYr` from (select year(`db_covid`.`owid-covid-data`.`date`) AS `_Yr`,`db_covid`.`owid-covid-data`.`location` AS `location`,sum(`db_covid`.`owid-covid-data`.`total_cases`) AS `total_cases_perLocation` from `db_covid`.`owid-covid-data` group by year(`db_covid`.`owid-covid-data`.`date`),`db_covid`.`owid-covid-data`.`location` order by `db_covid`.`owid-covid-data`.`location`,year(`db_covid`.`owid-covid-data`.`date`)) `t` order by `t`.`location`,`t`.`_Yr`